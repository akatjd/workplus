<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml"
	  xmlns:sec="http://www.w3.org/1999/xhtml"
	  xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	  layout:decorate="~{layout/default_layout}">
	  
    <th:block layout:fragment="head">
	    <title>Home</title>
	    
	    <!--/* css */-->
	    <link th:href="@{/css/common.css}" rel="stylesheet" />
	    
	    <style>
	      div.myPage {
	        width: 100%;
	        height: 480px;
	        border: 1px solid #003458;
	      }
	      div.left {
	        width: 20%;
	        float: left;
	        box-sizing: border-box;
	        background: rgba(0, 0, 0, 0);
	      }
	      div.right {
	        width: 80%;
	        float: right;
	        box-sizing: border-box;
	        background: rgba(0, 0, 0, 0);
	      }
	    </style>
    </th:block>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script th:inline="javascript">
	    $(document).ready(function(){
			$("#submit").on("click", function(){
				var nickChkVal = $("#nickChk").val();
				if(nickChkVal == "N"){
					alert("닉네임 중복확인을 해주세요.");
				}else if(nickChkVal =="Y"){
					$("#frm").submit();
				}
			});
		})
    
	    function fn_nickChk(){
	    	if($("#nickname").val()==""){
				alert("닉네임을 입력해주세요.");
				$("#nickname").focus();
				return false;
			}
	    	console.log($("#nickname").val());
			$.ajax({
				url : "/workplus/nickChk.do",
				type : "post",
				dataType : "json",
				data : {"nickname" : $("#nickname").val()},
				success : function(data){
					if(data >= 1){
						alert("중복된 닉네임입니다.");
					}else if(data == 0){
						$("#nickChk").attr("value", "Y");
						alert("사용가능한 닉네임입니다.");
					}
				},
				error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
	                alert("통신 실패.")
	            }
			})
		}
	    
	    function rowClick(id){
	    	var popupX = (document.body.offsetWidth/2) - (700/2);
	    	popupX += window.screenLeft; // 듀얼 모니터일 때
	    	var popupY = (window.screen.height/2) - (400/2);
	        window.open(
	            "update_pw_pop_up.do",
	            "update_pw_pop_up_frame",
	            "width=700, height = 400, left="+ popupX + ", top="+ popupY
	        );
	    }
    </script>
    
    <body>
    
    	<th:block layout:fragment="header" th:include="@{/fragments/header}">
			<h1>Home Page</h1>
	        <hr>
	        <a sec:authorize="isAnonymous()" th:href="@{/workplus/login.do}">로그인</a>
	        <a sec:authorize="isAuthenticated()" th:href="@{/logout}">로그아웃</a>
	        <a sec:authorize="isAnonymous()" th:href="@{/workplus/signup.do}">회원가입</a>
	        <a sec:authorize="hasRole('ROLE_MEMBER')" th:href="@{/workplus/member/info.do}">내정보</a>
			<a sec:authorize="hasRole('ROLE_ADMIN')" th:href="@{/workplus/admin.do}">어드민</a>
		</th:block>
		
		<div layout:fragment="content" class="content">
			<h1>마이페이지</h1>
			<div class="myPage">
			    <div class="left">
			      왼쪽<br>
			      <img th:src="'/upload/' + ${fileCours}" width="200" height="200"><br>
			      <div style="float:left;position:relative;left:10%">
				 	 <a href="#" class="btn btn-primary active" role="button" data-bs-toggle="button" aria-pressed="true">프로필 관리</a>
				  </div>		  
			    </div>
			    <div class="right">
				    오른쪽<br>
				<form id="frm" th:object="${memberDto}" th:action="@{/workplus/member/updateProfile.do}" method="post" enctype="multipart/form-data">
				    <div class="input-group mb-3">
				    	<label for="staticEmail" class="col-sm-2 col-form-label">프로필 사진 변경</label>
						<input type="file" class="form-control" name="file" id="inputGroupFile02">
					</div>
					<div class="mb-3 row">
						<label for="staticEmail" class="col-sm-2 col-form-label">아이디</label>
						<div class="col-sm-10">
							<input type="text" readonly class="form-control-plaintext" name="memberId" id="memberId" th:value="${member.memberId}">
						</div>
					</div>	
					
					<div class="input-group mb-3">
						<label for="phone" class="col-sm-2 col-form-label">닉네임</label>
						<input type="text" class="form-control" th:value="${member.nickname}" name="nickname" id="nickname" aria-describedby="button-addon2">
						<button class="btn btn-outline-secondary" type="button" name="nickChk" style="padding:10px 40px" onclick="fn_nickChk();" value="N">중복확인</button>
					</div>
					
					<div class="input-group mb-3">
						<label for="phone" class="col-sm-2 col-form-label">비밀번호</label>
						<input type="password" class="form-control" aria-describedby="button-addon2" name="password" id="password">
						<button class="btn btn-outline-secondary" type="button" id="button-addon2" style="padding:10px 8px" th:onclick="rowClick()">비밀번호변경하기</button>
					</div>
					
					<div class="input-group mb-3">
						<label for="phone" class="col-sm-2 col-form-label">핸드폰번호</label>
						<input type="text" class="form-control" aria-describedby="button-addon2" name="hphone" id="hphone" th:value="${member.hphone}">
						<button class="btn btn-outline-secondary" type="button" id="button-addon2" style="padding:10px 40px">인증하기</button>
					</div>
					
					<div style="float:right">
						<a href="#" class="btn btn-primary active" role="button" data-bs-toggle="button" aria-pressed="true" onclick="document.getElementById('frm').submit();">저장하기</a>
						&nbsp;
						<a href="#" class="btn btn-primary active" role="button" data-bs-toggle="button" aria-pressed="true">탈퇴하기</a>
						&nbsp;
					</div>
				</form>
			    </div>
		    </div>
		</div>
			
		<th:block layout:fragment="footer" th:include="@{/fragments/footer}"></th:block> 
		
    </body>
</html>